<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>demo</title>
		<style>
			body {
				background-color: black;
				color: white;
			}
		</style>
	</head>
	<body>
		<canvas width="500" height="200"></canvas>
	</body>
	<script type="module">
		import { Pane } from "https://esm.sh/tweakpane@4";
		import * as d3 from "https://esm.sh/d3@7";
		let { default: burn } = await import("./mod.ts").catch((err) => {
			console.warn(
				"Vite dev server is not running. Falling back to the CDN version: `https://esm.sh/gh/manzt/burn/mod.ts`.\n\n" +
					"Ensure Vite is running if you intended to use the local development build.",
			);
			return import("https://esm.sh/gh/manzt/burn/mod.ts");
		});

		let createPallete = (interpolate) =>
			Array
				.from({ length: 37 }, (_, i) => interpolate(i / 36))
				.map((c) => {
					let { r, g, b } = d3.color(c);
					return [r, g, b];
				});

		let pallete = "inferno";
		let palletes = {
			blues: d3.interpolateBlues,
			greens: d3.interpolateGreens,
			inferno: d3.interpolateInferno,
			magma: d3.interpolateMagma,
			viridis: d3.interpolateViridis,
		};

		let canvas = document.querySelector("canvas");
		canvas.width = document.querySelector("body").clientWidth;
		let fire = globalThis.fire = burn(canvas, {
			pallete: createPallete(palletes[pallete]),
		});

		{
			let pane = new Pane();
			let PARAMS = {
				get interval() {
					return fire.interval;
				},
				set interval(value) {
					fire.interval = value;
				},
				get pallete() {
					return pallete;
				},
				set pallete(value) {
					pallete = value;
					fire.pallete = createPallete(palletes[pallete]);
				},
			};
			pane.addButton({ title: "Start" }).on("click", () => fire.start());
			pane.addButton({ title: "Stop" }).on("click", () => fire.stop());
			pane.addButton({ title: "Reset" }).on("click", () => fire.reset());
			pane.addBinding(PARAMS, "interval", { min: 10, max: 100 });
			pane.addBinding(PARAMS, "pallete", {
				options: Object.fromEntries(
					Object.keys(palletes).map((k) => [k, k]),
				),
			});
		}
	</script>
</html>
